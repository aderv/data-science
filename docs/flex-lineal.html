<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>10&nbsp; Controlando la flexibilidad del modelo de regresión lineal – Ciencia de Datos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./reg-multiple.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-JBLWWCLEGX"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-JBLWWCLEGX', { 'anonymize_ip': true});
</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="site_libs/plotly-binding-4.10.4/plotly.js"></script>

<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>

<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>

<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles/global.css">
</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ds-intro.html">Ciencia de datos</a></li><li class="breadcrumb-item"><a href="./flex-lineal.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Controlando la flexibilidad del modelo de regresión lineal</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Buscar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Ciencia de Datos</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Presentación</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Análisis Exploratorio</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introducción al uso de <code>R</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./uso-ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Uso de <code>ggplot2</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./uso-dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Uso de <code>dplyr</code></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Inferencia clásica</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Probabilidad</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-estimacion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Estimación</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-hipotesis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pruebas de hipótesis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Ciencia de datos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ds-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Definiciones</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reg-simple.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regresión lineal simple</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reg-multiple.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Regresión lineal múltiple</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./flex-lineal.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Controlando la flexibilidad del modelo de regresión lineal</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referencias</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
  <li><a href="#selección-de-variables" id="toc-selección-de-variables" class="nav-link active" data-scroll-target="#selección-de-variables"><span class="header-section-number">10.1</span> Selección de variables</a>
  <ul class="collapse">
  <li><a href="#selección-exhaustiva" id="toc-selección-exhaustiva" class="nav-link" data-scroll-target="#selección-exhaustiva"><span class="header-section-number">10.1.1</span> selección exhaustiva:</a></li>
  <li><a href="#métodos-heurísticos-selección-hacia-adelante-o-hacia-atrás." id="toc-métodos-heurísticos-selección-hacia-adelante-o-hacia-atrás." class="nav-link" data-scroll-target="#métodos-heurísticos-selección-hacia-adelante-o-hacia-atrás."><span class="header-section-number">10.1.2</span> Métodos heurísticos: Selección hacia adelante o hacia atrás.</a></li>
  <li><a href="#combinación-de-métodos" id="toc-combinación-de-métodos" class="nav-link" data-scroll-target="#combinación-de-métodos"><span class="header-section-number">10.1.3</span> Combinación de métodos</a></li>
  </ul></li>
  <li><a href="#métodos-tipo-penalización" id="toc-métodos-tipo-penalización" class="nav-link" data-scroll-target="#métodos-tipo-penalización"><span class="header-section-number">10.2</span> Métodos tipo penalización</a>
  <ul class="collapse">
  <li><a href="#regresión-ridge" id="toc-regresión-ridge" class="nav-link" data-scroll-target="#regresión-ridge"><span class="header-section-number">10.2.1</span> Regresión <em>Ridge</em></a></li>
  <li><a href="#regresión-lasso" id="toc-regresión-lasso" class="nav-link" data-scroll-target="#regresión-lasso"><span class="header-section-number">10.2.2</span> Regresión <em>Lasso</em></a></li>
  </ul></li>
  <li><a href="#reducción-de-la-dimensionalidad" id="toc-reducción-de-la-dimensionalidad" class="nav-link" data-scroll-target="#reducción-de-la-dimensionalidad"><span class="header-section-number">10.3</span> Reducción de la dimensionalidad </a>
  <ul class="collapse">
  <li><a href="#regresión-por-componentes-principales-pcr" id="toc-regresión-por-componentes-principales-pcr" class="nav-link" data-scroll-target="#regresión-por-componentes-principales-pcr"><span class="header-section-number">10.3.1</span> Regresión por componentes principales (PCR)</a></li>
  <li><a href="#cuadrados-mínimos-parciales-pls" id="toc-cuadrados-mínimos-parciales-pls" class="nav-link" data-scroll-target="#cuadrados-mínimos-parciales-pls"><span class="header-section-number">10.3.2</span> Cuadrados mínimos parciales (PLS)</a></li>
  </ul></li>
  <li><a href="#caso-de-estudio" id="toc-caso-de-estudio" class="nav-link" data-scroll-target="#caso-de-estudio"><span class="header-section-number">11</span> Caso de estudio</a>
  <ul class="collapse">
  <li><a href="#cargamos-las-librerías-necesarias" id="toc-cargamos-las-librerías-necesarias" class="nav-link" data-scroll-target="#cargamos-las-librerías-necesarias"><span class="header-section-number">11.1</span> Cargamos las librerías necesarias</a></li>
  <li><a href="#breve-descripción-de-la-base-de-datos" id="toc-breve-descripción-de-la-base-de-datos" class="nav-link" data-scroll-target="#breve-descripción-de-la-base-de-datos"><span class="header-section-number">11.2</span> Breve descripción de la base de datos</a>
  <ul class="collapse">
  <li><a href="#algunas-gráficas-y-resúmenes-interesantes" id="toc-algunas-gráficas-y-resúmenes-interesantes" class="nav-link" data-scroll-target="#algunas-gráficas-y-resúmenes-interesantes"><span class="header-section-number">11.2.1</span> Algunas gráficas y resúmenes interesantes</a></li>
  </ul></li>
  <li><a href="#validación-cruzada" id="toc-validación-cruzada" class="nav-link" data-scroll-target="#validación-cruzada"><span class="header-section-number">11.3</span> Validación cruzada</a>
  <ul class="collapse">
  <li><a href="#ajsute-de-modelos-lineales" id="toc-ajsute-de-modelos-lineales" class="nav-link" data-scroll-target="#ajsute-de-modelos-lineales"><span class="header-section-number">11.3.1</span> Ajsute de modelos lineales</a></li>
  <li><a href="#validación-cruzada-1" id="toc-validación-cruzada-1" class="nav-link" data-scroll-target="#validación-cruzada-1"><span class="header-section-number">11.3.2</span> Validación cruzada</a></li>
  <li><a href="#matriz-de-proyección" id="toc-matriz-de-proyección" class="nav-link" data-scroll-target="#matriz-de-proyección"><span class="header-section-number">11.3.3</span> Matriz de proyección</a></li>
  </ul></li>
  <li><a href="#selección-de-variables-1" id="toc-selección-de-variables-1" class="nav-link" data-scroll-target="#selección-de-variables-1"><span class="header-section-number">11.4</span> Selección de variables</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ds-intro.html">Ciencia de datos</a></li><li class="breadcrumb-item"><a href="./flex-lineal.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Controlando la flexibilidad del modelo de regresión lineal</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Controlando la flexibilidad del modelo de regresión lineal</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Existen diversos métodos para comparar modelos lineales. La flexibilidad del modelo se puede medir en términos del número de variables, de tal forma que entre más variables tenemos en un modelo lineal, más flexible es. Hay varias formas de controlar esta flexibilidad:</p>
<section id="selección-de-variables" class="level2 page-columns page-full" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="selección-de-variables"><span class="header-section-number">10.1</span> Selección de variables</h2>
<p>Suponga que se tiene un modelo lineal con <span class="math inline">\(p\)</span> variables <span class="math display">\[y_i = \beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} +...+ \beta_p x_{ip} + \epsilon_i\]</span></p>
<p>El objetivo es determinar cuáles de estas variables deben ir en el modelo <em>final</em>. Para comparar modelos tenemos diversos criterios. El <span class="math inline">\(R^2\)</span> es útil para comparar modelos con igual número de variables. En caso de que tengan diferente número de variables, tenemos alternativas como: <span class="math inline">\(R_{adj}^2\)</span>, <span class="math inline">\(AIC\)</span>, <span class="math inline">\(C_p\)</span> y <span class="math inline">\(BIC\)</span>.</p>
<section id="selección-exhaustiva" class="level3 page-columns page-full" data-number="10.1.1">
<h3 data-number="10.1.1" class="anchored" data-anchor-id="selección-exhaustiva"><span class="header-section-number">10.1.1</span> selección exhaustiva:</h3>
<p>Se ajustan todos los modelos posibles, desde el modelo con 0 variables (solo el intercepto) hasta el modelo con todas las <span class="math inline">\(p\)</span> variables. Se comparan de forma adecuada para obtener el “mejor” modelo. Este método implica ajustar <span class="math inline">\(2^p\)</span><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> submodelos, lo cuál puede fácilmente convertirse en algo imposible de llevar a cabo en la práctica, dado su costo computacional.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;corresponde a la suma de todos los modelos de 0, 1, 2, …, k, …, p variables <span class="math display">\[\binom{p}{0} + \binom{p}{1} + \cdots + \binom{p}{p} = \sum_{k=0}^{p}\binom{p}{k} = 2^p\]</span></p></div></div></section>
<section id="métodos-heurísticos-selección-hacia-adelante-o-hacia-atrás." class="level3 page-columns page-full" data-number="10.1.2">
<h3 data-number="10.1.2" class="anchored" data-anchor-id="métodos-heurísticos-selección-hacia-adelante-o-hacia-atrás."><span class="header-section-number">10.1.2</span> Métodos heurísticos: Selección hacia adelante o hacia atrás.</h3>
<p>Para evitar el crecimiento exponencial en la cantidad de modelos a ajustar, se puede optar por un procedimiento heurístico de selección hacia adelante o hacia atrás. En el caso de selección hacia adelante, se inicia con el modelo que no contiene variables (<span class="math inline">\(\mathcal{M}_0\)</span>), y se forman <span class="math inline">\(p\)</span> modelos univariados agregando cada una de las <span class="math inline">\(p\)</span> variables, se escoge el <em>mejor</em> de estos modelos (que puede ser elegido con el <span class="math inline">\(R^2\)</span> ya que tienen el mismo número de variables), llamemos a este modelo <span class="math inline">\(\mathcal{M}_1\)</span>. A <span class="math inline">\(\mathcal{M}_1\)</span> se le agrega cada una de las <span class="math inline">\(p-1\)</span> variables restantes y se elige el <em>mejor</em> modelo de 2 variables: <span class="math inline">\(\mathcal{M}_2\)</span>. Al final se tendrán <span class="math inline">\(1 + \frac{p(p+1)}{2}\)</span><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> modelos: <span class="math display">\[\mathcal{M}_0, \mathcal{M}_1, \mathcal{M}_2, \cdots, \mathcal{M}_p\]</span> Para elegir entre estos modelos, no es adecuado el <span class="math inline">\(R^2\)</span> (¿por qué?) y debe recurrirse a medidas tales como: <span class="math inline">\(R_{adj}^2\)</span>, <span class="math inline">\(AIC\)</span>, <span class="math inline">\(C_p\)</span> y <span class="math inline">\(BIC\)</span>, sin olvidar que para el <span class="math inline">\(R_{adj}^2\)</span> se busca el modelo con mayor valor, y para el resto de métricas se busca el menor valor (¿por qué?). También es posible hacer <em>Cross Validation</em> (CV) y elegir el modelo con menor <span class="math inline">\(MSE_{cv}\)</span>, pero para el caso de regresión lineal, no es necesario hacerlo (¿por qué?).</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;Es fácil comprobar que <span class="math display">\[1 + p + (p-1) + (p-2) + \cdots + 1 = 1 + \sum_{k=1}^{p}k = 1 + \frac{p(p+1)}{2}\]</span></p></div></div><p>En la tabla, se muestra cómo crece la cantidad de modelos a ajustar según la metodología: exhaustivo o heurístico.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   Variables       Exhaustivo Heurístico
1          5               32         16
2         10             1024         56
3         15            32768        121
4         20          1048576        211
5         25         33554432        326
6         30       1073741824        466
7         35      34359738368        631
8         40    1099511627776        821
9         45   35184372088832       1036
10        50 1125899906842624       1276</code></pre>
</div>
</div>
<p>Es claro que el método secuencial ofrece ventajas en cuánto a la cantidad de modelos que se deben ajustar, sin embargo, es probable que el resultado de estos procedimientos no sea el modelo óptimo (¿por qué?)</p>
</section>
<section id="combinación-de-métodos" class="level3" data-number="10.1.3">
<h3 data-number="10.1.3" class="anchored" data-anchor-id="combinación-de-métodos"><span class="header-section-number">10.1.3</span> Combinación de métodos</h3>
<p>En algunos casos (cuando hay muchas variables), incluso un método secuencial puede resultar poco atractivo para la selección de variables. Para estos casos, se puede establecer un límite, por ejemplo, si se usa selección hacia adelante, se pone una cota <span class="math inline">\(L\)</span> al número de variables a incluir, siendo <span class="math inline">\(L&lt;&lt;p\)</span>. También es posible combinar (piense bien cómo sería eso) los métodos de selección hacia adelante y hacia atrás, esto con el fin de aumentar la probabilidad de llegar al modelo óptimo.</p>
</section>
</section>
<section id="métodos-tipo-penalización" class="level2 page-columns page-full" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="métodos-tipo-penalización"><span class="header-section-number">10.2</span> Métodos tipo penalización</h2>
<p>Un enfoque alternativo a la selección directa de variables, para el control de la flexibilidad del modelo lineal, es la penalización. La idea es considerar el modelo completo con las <span class="math inline">\(p\)</span> variables y <em>encoger</em> el efecto de dichas variables a través de una penalización. Recuerde que el método de mínimos cuadrados, resuelve el problema de optimización</p>
<p><span class="math display">\[
\hat{\boldsymbol{\beta}} = \underset{\boldsymbol{\beta} \in \mathbb{R}^{p+1}}{\arg\min} \sum_{i=1}^{n} \left( y_i - \beta_0 - \sum_{j=1}^{p}\beta_j x_{ij}\right)^2
\]</span> Replanteando el problema como</p>
<p><span class="math display">\[
\hat{\boldsymbol{\beta}} = \underset{\boldsymbol{\beta} \in \mathbb{R}^{p+1}}{\arg\min} \sum_{i=1}^{n} \left( y_i - \beta_0 - \sum_{j=1}^{p}\beta_j x_{ij}\right)^2 + Penalización
\]</span></p>
<p>Al agregar un término de penalización se espera un aumento del sesgo del modelo (¿por qué?) pero también una reducción significativa de la varianza (de hecho, ese es el <em>truco</em> u objetivo al agregar penalizaciones) por lo que al final, considerando la combinación de ambos efectos (¿cuáles?), podríamos tener una reducción en el error esperado de predicción de nuestro modelo.</p>
<p>Hay muchas formas de agregar la <span class="math inline">\(Penalización\)</span> Veamos las 2 más comunes</p>
<section id="regresión-ridge" class="level3 page-columns page-full" data-number="10.2.1">
<h3 data-number="10.2.1" class="anchored" data-anchor-id="regresión-ridge"><span class="header-section-number">10.2.1</span> Regresión <em>Ridge</em></h3>
<p>Se habla de <em>Ridge Regression</em> cuando la penalización en el problema de optimización se plantea con la suma de los coeficientes al cuadradro, es decir:</p>
<p><span class="math display">\[
\hat{\boldsymbol{\beta}}_{Ridge} = \underset{\boldsymbol{\beta} \in \mathbb{R}^{p+1}}{\arg\min} \sum_{i=1}^{n} \left( y_i - \beta_0 - \sum_{j=1}^{p}\beta_j x_{ij}\right)^2 + \lambda\sum_{j=1}^{p}\beta_j^2 \hspace{2cm} \lambda \geq0
\]</span></p>
<p>Algunos apuntes sobre este enfoque</p>
<ul>
<li>La penalización no incluye a <span class="math inline">\(\beta_0\)</span> ya que la idea es penalizar el efecto de las variables, y no hay variable asociada al intercetpo.</li>
<li>cuando <span class="math inline">\(\lambda=0\)</span> el resultado es mínimos cuadrados ordinarios (el de toda la vida)</li>
<li>La solución al problema de optimización se puede expresar de forma cerrada<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> <span class="math display">\[\hat{\boldsymbol{\beta}}_{Ridge} = \left( \boldsymbol{X^TX} + \lambda \boldsymbol{I}\right)^{-1} \boldsymbol{X^TY}\]</span> Aquí debe hacerse más claro aún que cuando <span class="math inline">\(\lambda=0\)</span> se tiene el método de mínimos cuadrados ordinarios (¿por qué?).</li>
</ul>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;Bono para quien lo haga y lo explique</p></div></div><p>¿Qué se ha ganado realmente?<br>
Ya no es necesario seleccionar variables. En algunos casos, aunque la selección de variables se haga de forma metódica, no hay relaciones causales bien definidas en el modelo obtenido (¿cómo así, eso qué significa?).</p>
<p>¿Qué debemos hacer entonces?<br>
Hemos cambiado el problema de seleccionar variables a seleccionar un valor de <span class="math inline">\(\lambda\)</span> que sea un <em>trade-off</em> entre sesgo y varianza del modelo. Esto es lo que se conoce como calibración del modelo o selección del <em>tuning parameter</em>. Una forma de hacerlo es usando CV. Se selecciona un conjunto de valores para <span class="math inline">\(\lambda\)</span>, por ejemplo: <span class="math inline">\(\lambda_1, \lambda_2, \lambda_3, \cdots, \lambda_m\)</span> se calcula el <span class="math inline">\(MSE\)</span> con CV para cada caso y se busca el valor de <span class="math inline">\(\lambda\)</span> con mínimo <span class="math inline">\(MSE\)</span> (asegúrese de entender bien este procedimiento, por ejemplo, <strong>¿qué sería usar 10-fold cv para 15 valores de <span class="math inline">\(\lambda\)</span>?</strong>)</p>
</section>
<section id="regresión-lasso" class="level3 page-columns page-full" data-number="10.2.2">
<h3 data-number="10.2.2" class="anchored" data-anchor-id="regresión-lasso"><span class="header-section-number">10.2.2</span> Regresión <em>Lasso</em></h3>
<p>Un modelo Lasso se obtiene al plantear la penalización con el valor absoluto:</p>
<p><span class="math display">\[
\hat{\boldsymbol{\beta}}_{Lasso} = \underset{\boldsymbol{\beta} \in \mathbb{R}^{p+1}}{\arg\min} \sum_{i=1}^{n} \left( y_i - \beta_0 - \sum_{j=1}^{p}\beta_j x_{ij}\right)^2 + \lambda\sum_{j=1}^{p}|{\beta_j}| \hspace{2cm} \lambda \geq0
\]</span></p>
<p>Para este caso no hay solución cerrada para el problema de optimización, pero no es problema, existen algoritmos numéricos muy eficientes para hacer la tarea.</p>
<p>Tenga en cuenta el otro punto de vista para estos dos modelos: <em>Ridge</em> y <em>Lasso</em>. El que considera la función de mínimos cuadrados ordinaria pero agregando una restricción.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;Una o varias preguntas del examen se referirán a la interpretación de esto</p></div></div></section>
</section>
<section id="reducción-de-la-dimensionalidad" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="reducción-de-la-dimensionalidad"><span class="header-section-number">10.3</span> Reducción de la dimensionalidad <a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></h2>
<section id="regresión-por-componentes-principales-pcr" class="level3" data-number="10.3.1">
<h3 data-number="10.3.1" class="anchored" data-anchor-id="regresión-por-componentes-principales-pcr"><span class="header-section-number">10.3.1</span> Regresión por componentes principales (PCR)</h3>
</section>
<section id="cuadrados-mínimos-parciales-pls" class="level3" data-number="10.3.2">
<h3 data-number="10.3.2" class="anchored" data-anchor-id="cuadrados-mínimos-parciales-pls"><span class="header-section-number">10.3.2</span> Cuadrados mínimos parciales (PLS)</h3>
</section>
</section>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;El profesor dice que deberían investigar sobre este tema para el examen</p></div></div><section id="caso-de-estudio" class="level1 page-columns page-full" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Caso de estudio</h1>
<section id="cargamos-las-librerías-necesarias" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="cargamos-las-librerías-necesarias"><span class="header-section-number">11.1</span> Cargamos las librerías necesarias</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Broom
</div>
</div>
<div class="callout-body-container callout-body">
<p>La librería <code>broom</code> trae funciones que permiten convertir diversos objetos de <code>R</code> en <em>data.frame</em>. Es muy útil para trabajar con el <em>tidyverse</em></p>
</div>
</div>
</section>
<section id="breve-descripción-de-la-base-de-datos" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="breve-descripción-de-la-base-de-datos"><span class="header-section-number">11.2</span> Breve descripción de la base de datos</h2>
<p>La base de datos contiene información sobre diferentes características físicas y químicas de más de 1000 muestras de vino.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"WineQT.csv"</span>, <span class="at">header =</span> T) <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(datos)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,143
Columns: 13
$ fixed.acidity        &lt;dbl&gt; 7.4, 7.8, 7.8, 11.2, 7.4, 7.4, 7.9, 7.3, 7.8, 6.7…
$ volatile.acidity     &lt;dbl&gt; 0.700, 0.880, 0.760, 0.280, 0.700, 0.660, 0.600, …
$ citric.acid          &lt;dbl&gt; 0.00, 0.00, 0.04, 0.56, 0.00, 0.00, 0.06, 0.00, 0…
$ residual.sugar       &lt;dbl&gt; 1.9, 2.6, 2.3, 1.9, 1.9, 1.8, 1.6, 1.2, 2.0, 1.8,…
$ chlorides            &lt;dbl&gt; 0.076, 0.098, 0.092, 0.075, 0.076, 0.075, 0.069, …
$ free.sulfur.dioxide  &lt;dbl&gt; 11, 25, 15, 17, 11, 13, 15, 15, 9, 15, 16, 9, 35,…
$ total.sulfur.dioxide &lt;dbl&gt; 34, 67, 54, 60, 34, 40, 59, 21, 18, 65, 59, 29, 1…
$ density              &lt;dbl&gt; 0.9978, 0.9968, 0.9970, 0.9980, 0.9978, 0.9978, 0…
$ pH                   &lt;dbl&gt; 3.51, 3.20, 3.26, 3.16, 3.51, 3.51, 3.30, 3.39, 3…
$ sulphates            &lt;dbl&gt; 0.56, 0.68, 0.65, 0.58, 0.56, 0.56, 0.46, 0.47, 0…
$ alcohol              &lt;dbl&gt; 9.4, 9.8, 9.8, 9.8, 9.4, 9.4, 9.4, 10.0, 9.5, 9.2…
$ quality              &lt;int&gt; 5, 5, 5, 6, 5, 5, 5, 7, 7, 5, 5, 5, 7, 6, 5, 5, 5…
$ Id                   &lt;int&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 10, 12, 13, 16, 19, 21…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> fixed.acidity    volatile.acidity  citric.acid     residual.sugar  
 Min.   : 4.600   Min.   :0.1200   Min.   :0.0000   Min.   : 0.900  
 1st Qu.: 7.100   1st Qu.:0.3925   1st Qu.:0.0900   1st Qu.: 1.900  
 Median : 7.900   Median :0.5200   Median :0.2500   Median : 2.200  
 Mean   : 8.311   Mean   :0.5313   Mean   :0.2684   Mean   : 2.532  
 3rd Qu.: 9.100   3rd Qu.:0.6400   3rd Qu.:0.4200   3rd Qu.: 2.600  
 Max.   :15.900   Max.   :1.5800   Max.   :1.0000   Max.   :15.500  
   chlorides       free.sulfur.dioxide total.sulfur.dioxide    density      
 Min.   :0.01200   Min.   : 1.00       Min.   :  6.00       Min.   :0.9901  
 1st Qu.:0.07000   1st Qu.: 7.00       1st Qu.: 21.00       1st Qu.:0.9956  
 Median :0.07900   Median :13.00       Median : 37.00       Median :0.9967  
 Mean   :0.08693   Mean   :15.62       Mean   : 45.91       Mean   :0.9967  
 3rd Qu.:0.09000   3rd Qu.:21.00       3rd Qu.: 61.00       3rd Qu.:0.9978  
 Max.   :0.61100   Max.   :68.00       Max.   :289.00       Max.   :1.0037  
       pH          sulphates         alcohol         quality     
 Min.   :2.740   Min.   :0.3300   Min.   : 8.40   Min.   :3.000  
 1st Qu.:3.205   1st Qu.:0.5500   1st Qu.: 9.50   1st Qu.:5.000  
 Median :3.310   Median :0.6200   Median :10.20   Median :6.000  
 Mean   :3.311   Mean   :0.6577   Mean   :10.44   Mean   :5.657  
 3rd Qu.:3.400   3rd Qu.:0.7300   3rd Qu.:11.10   3rd Qu.:6.000  
 Max.   :4.010   Max.   :2.0000   Max.   :14.90   Max.   :8.000  
       Id      
 Min.   :   0  
 1st Qu.: 411  
 Median : 794  
 Mean   : 805  
 3rd Qu.:1210  
 Max.   :1597  </code></pre>
</div>
</div>
<section id="algunas-gráficas-y-resúmenes-interesantes" class="level3" data-number="11.2.1">
<h3 data-number="11.2.1" class="anchored" data-anchor-id="algunas-gráficas-y-resúmenes-interesantes"><span class="header-section-number">11.2.1</span> Algunas gráficas y resúmenes interesantes</h3>
<p>Observemos una gráfica de la correlación entre cada par de variables, omitiendo <code>ID</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">!</span>Id) <span class="sc">|&gt;</span> <span class="fu">cor</span>() <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggcorrplot</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="flex-lineal_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Graficamos la variable densidad contra cada una de las variables:</p>
<ul>
<li>acidez fija</li>
<li>alcohol</li>
<li>acidez volátil</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> datos <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fixed.acidity,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> density)) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"#FF7857"</span>) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> datos <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> alcohol,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> density)) <span class="sc">+</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"#A480E7"</span>) <span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> datos <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> volatile.acidity,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> density)) <span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>(p1<span class="sc">|</span>p2)<span class="sc">/</span>p3</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'
`geom_smooth()` using formula = 'y ~ x'
`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="flex-lineal_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="validación-cruzada" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="validación-cruzada"><span class="header-section-number">11.3</span> Validación cruzada</h2>
<section id="ajsute-de-modelos-lineales" class="level3" data-number="11.3.1">
<h3 data-number="11.3.1" class="anchored" data-anchor-id="ajsute-de-modelos-lineales"><span class="header-section-number">11.3.1</span> Ajsute de modelos lineales</h3>
<p>Seleccionamos solo las 3 variables que hemos decidido trabajar y las renombramos usano funciones de <code>dplyr</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>datos_sub <span class="ot">&lt;-</span> datos <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="at">densidad =</span> density,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">acidez.f =</span> fixed.acidity,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">acidez.v =</span> volatile.acidity,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                             alcohol)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ajustamos un modelo simple para cada variable considerada</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(densidad <span class="sc">~</span> acidez.f, <span class="at">data =</span> datos_sub)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = densidad ~ acidez.f, data = datos_sub)

Residuals:
       Min         1Q     Median         3Q        Max 
-0.0064269 -0.0007442  0.0000533  0.0009530  0.0055416 

Coefficients:
              Estimate Std. Error t value            Pr(&gt;|t|)    
(Intercept) 0.99049119 0.00020268 4886.97 &lt;0.0000000000000002 ***
acidez.f    0.00075071 0.00002387   31.46 &lt;0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.001409 on 1141 degrees of freedom
Multiple R-squared:  0.4644,    Adjusted R-squared:  0.464 
F-statistic: 989.5 on 1 and 1141 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(<span class="fu">summary</span>(mod1))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept) 0.990    0.000203     4887.  0        
2 acidez.f    0.000751 0.0000239      31.5 6.65e-157</code></pre>
</div>
</div>
<p>Observe la diferencia cuando se aplica la función <code>tidy</code> del paquete <code>broom</code>. Es bastante útil para usar combinando con el operador <em>pipe</em></p>
<p>Ajustamos los dos modelos restantes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(densidad <span class="sc">~</span> alcohol, <span class="at">data =</span> datos_sub)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(densidad <span class="sc">~</span> acidez.v, <span class="at">data =</span> datos_sub)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Verificoamos el <span class="math inline">\(R^2\)</span> de cada modelo</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>r2_1 <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod1)<span class="sc">$</span>r.squared</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>r2_2 <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod2)<span class="sc">$</span>r.squared</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>r2_3 <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod3)<span class="sc">$</span>r.squared</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>r2_1</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4644435</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>r2_2</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2447547</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>r2_3</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0002726303</code></pre>
</div>
</div>
</section>
<section id="validación-cruzada-1" class="level3" data-number="11.3.2">
<h3 data-number="11.3.2" class="anchored" data-anchor-id="validación-cruzada-1"><span class="header-section-number">11.3.2</span> Validación cruzada</h3>
<p>Queremos ver cómo funciona el método de validación cruzada para comparar modelos, recuerde que esto no es necesario para un modelo de regresión lineal pero lo haremos en el contexto de modelos lineales por la familiaridad del tema</p>
<p>Establecemos unos valores para la cantidad de particiones</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">22</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>k_fold <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(datos_sub)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>celda <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(n<span class="sc">/</span>k_fold)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Evaluamos o calculamos el <span class="math inline">\(MSE\)</span> para el modelo 1. Para esto, creamos una partición aleatoria de los datos y creamos un vector para guardar el <span class="math inline">\(MSE\)</span> de cada iteración</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>permutacion <span class="ot">&lt;-</span> <span class="fu">sample</span>(n)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> k_fold)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k_fold){</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> permutacion[((i<span class="dv">-1</span>)<span class="sc">*</span>celda <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">min</span>(celda<span class="sc">*</span>i, n))]</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  datos_test <span class="ot">&lt;-</span> datos_sub[test,]</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  datos_train <span class="ot">&lt;-</span> datos_sub[<span class="sc">-</span>test,]</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  modelo <span class="ot">&lt;-</span> <span class="fu">lm</span>(densidad <span class="sc">~</span> acidez.f, <span class="at">data =</span> datos_train)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  mse[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>((datos_test<span class="sc">$</span>densidad <span class="sc">-</span> </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">predict</span>(modelo, <span class="at">newdata =</span> datos_test))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>mse_1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(mse)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hacemos lo propio para los 2 modelos restantes</p>
<p>Modelo con la variable <em>alcohol</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>permutacion <span class="ot">&lt;-</span> <span class="fu">sample</span>(n)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> k_fold)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k_fold){</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> permutacion[((i<span class="dv">-1</span>)<span class="sc">*</span>celda <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">min</span>(celda<span class="sc">*</span>i, n))]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  datos_test <span class="ot">&lt;-</span> datos_sub[test,]</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  datos_train <span class="ot">&lt;-</span> datos_sub[<span class="sc">-</span>test,]</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  modelo <span class="ot">&lt;-</span> <span class="fu">lm</span>(densidad <span class="sc">~</span> alcohol, <span class="at">data =</span> datos_train)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  mse[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>((datos_test<span class="sc">$</span>densidad <span class="sc">-</span> </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">predict</span>(modelo, <span class="at">newdata =</span> datos_test))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>mse_2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(mse)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Modelo con la variable acidez volátil</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>permutacion <span class="ot">&lt;-</span> <span class="fu">sample</span>(n)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> k_fold)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k_fold){</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> permutacion[((i<span class="dv">-1</span>)<span class="sc">*</span>celda <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">min</span>(celda<span class="sc">*</span>i, n))]</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  datos_test <span class="ot">&lt;-</span> datos_sub[test,]</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  datos_train <span class="ot">&lt;-</span> datos_sub[<span class="sc">-</span>test,]</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  modelo <span class="ot">&lt;-</span> <span class="fu">lm</span>(densidad <span class="sc">~</span> acidez.v, <span class="at">data =</span> datos_train)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  mse[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>((datos_test<span class="sc">$</span>densidad <span class="sc">-</span> </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">predict</span>(modelo, <span class="at">newdata =</span> datos_test))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>mse_3 <span class="ot">&lt;-</span> <span class="fu">mean</span>(mse)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Comparamos el resultado de cada modelo</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>mse_1</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.000001992099</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>mse_2</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.000002803126</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>mse_3</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.000003718297</code></pre>
</div>
</div>
<p>Organizamos los resultados</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>resultados <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Modelo =</span> <span class="fu">c</span>(<span class="st">"Acidez Fija"</span>, <span class="st">"Alcohol"</span>, <span class="st">"Acidez Volátil"</span>),</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">R2 =</span> <span class="fu">c</span>(r2_1, r2_2, r2_3),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">MSE_cv =</span> <span class="fu">c</span>(mse_1, mse_2, mse_3)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>resultados </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  Modelo               R2     MSE_cv
  &lt;chr&gt;             &lt;dbl&gt;      &lt;dbl&gt;
1 Acidez Fija    0.464    0.00000199
2 Alcohol        0.245    0.00000280
3 Acidez Volátil 0.000273 0.00000372</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(resultados)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 3
Columns: 3
$ Modelo &lt;chr&gt; "Acidez Fija", "Alcohol", "Acidez Volátil"
$ R2     &lt;dbl&gt; 0.4644434531, 0.2447547038, 0.0002726303
$ MSE_cv &lt;dbl&gt; 0.000001992099, 0.000002803126, 0.000003718297</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ejercicio para la casa, para el aburrimiento
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Programar en <code>R</code> una función que reciba el parámetro k_fold, la base de datos y las variables y devuelva el MSE de validación cruzada</p></li>
<li><p>Use la función del punto 1 para calcular LOOCV de los modelos resueltos en clase</p></li>
<li><p>Hacer validación cruzada usando librerías de <code>R</code>. Investigue</p></li>
</ol>
</div>
</div>
<p>Aplicamos LOOCV para el modelo con acidez fija</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>k_fold <span class="ot">&lt;-</span> n</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>permutacion <span class="ot">&lt;-</span> <span class="fu">sample</span>(n)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> k_fold)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k_fold){</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test &lt;- permutacion[((i-1)*celda + 1):(min(celda*i, n))]</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  datos_test <span class="ot">&lt;-</span> datos_sub[i,]</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  datos_train <span class="ot">&lt;-</span> datos_sub[<span class="sc">-</span>i,]</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  modelo <span class="ot">&lt;-</span> <span class="fu">lm</span>(densidad <span class="sc">~</span> acidez.f, <span class="at">data =</span> datos_train)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  mse[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>((datos_test<span class="sc">$</span>densidad <span class="sc">-</span> </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">predict</span>(modelo, <span class="at">newdata =</span> datos_test))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>mse_1_loocv <span class="ot">&lt;-</span> <span class="fu">mean</span>(mse)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>mse_1_loocv</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.000001990474</code></pre>
</div>
</div>
<p>Ahora usamos directamente las librerías de <code>R</code> para facilitar el trabajo de evaluación de los modelos. Usaremos <code>caret</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Cargando paquete requerido: lattice</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Adjuntando el paquete: 'caret'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    lift</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>train_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"LOOCV"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>mod1.caret <span class="ot">&lt;-</span> <span class="fu">train</span>(densidad <span class="sc">~</span> acidez.f, <span class="at">data =</span> datos_sub,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> train_control)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>mod1.caret</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression 

1143 samples
   1 predictor

No pre-processing
Resampling: Leave-One-Out Cross-Validation 
Summary of sample sizes: 1142, 1142, 1142, 1142, 1142, 1142, ... 
Resampling results:

  RMSE         Rsquared   MAE        
  0.001410841  0.4624204  0.001073912

Tuning parameter 'intercept' was held constant at a value of TRUE</code></pre>
</div>
</div>
<p>Veamos los resultados del ajuste y evluación del modelo</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>mod1.caret<span class="sc">$</span>results</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  intercept        RMSE  Rsquared         MAE
1      TRUE 0.001410841 0.4624204 0.001073912</code></pre>
</div>
</div>
<p>Extraemos el MSE (por LOOCV) del modelo</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>mse.loocv.caret <span class="ot">&lt;-</span> mod1.caret<span class="sc">$</span>results[<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>mse.loocv.caret</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            RMSE
1 0.000001990474</code></pre>
</div>
</div>
</section>
<section id="matriz-de-proyección" class="level3" data-number="11.3.3">
<h3 data-number="11.3.3" class="anchored" data-anchor-id="matriz-de-proyección"><span class="header-section-number">11.3.3</span> Matriz de proyección</h3>
<p>La matriz de proyección es la que convierte los valores observados en predicciones. Cuando los modelos tienen esta propiedad, se suelen llamar <strong>suavizadores lineales</strong>. El modelo de regresión lineal es uno de ellos.</p>
<p>La matriz de proyección también se llama: matriz sombrero (<em>hat</em>), matriz de influencia. Los elementos de la diagonal principal de esta matriz son los llamados <em>leverages</em> y se pueden interpretar como la influencia individual de cada punto en las predicciones. Algunas formas de analizar datos atípicos revisan estos <em>leverages</em>.</p>
<p>Calculemos la matriz de proyección para el modelo de acidez fija</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>mod_ac.f <span class="ot">&lt;-</span> <span class="fu">lm</span>(densidad <span class="sc">~</span> acidez.f, <span class="at">data =</span> datos_sub)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>mx <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>, n), datos_sub<span class="sc">$</span>acidez.f)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>mh <span class="ot">&lt;-</span> mx<span class="sc">%*%</span><span class="fu">solve</span>(<span class="fu">t</span>(mx)<span class="sc">%*%</span>mx)<span class="sc">%*%</span><span class="fu">t</span>(mx) </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>traza <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(mh))</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>mse_loocv_mh <span class="ot">&lt;-</span> <span class="fu">mean</span>((mod_ac.f<span class="sc">$</span>residuals<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">diag</span>(mh)))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>mse_loocv_mh</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.000001990474</code></pre>
</div>
</div>
<p>Podemos hacer esto mismo de una forma un poco más sencilla</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>leverage.mod_ac.f <span class="ot">&lt;-</span>  <span class="fu">lm.influence</span>(mod_ac.f)<span class="sc">$</span>hat</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(leverage.mod_ac.f)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>mse_loocv_mh_r <span class="ot">&lt;-</span> <span class="fu">mean</span>((mod_ac.f<span class="sc">$</span>residuals<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>leverage.mod_ac.f))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>mse_loocv_mh_r</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.000001990474</code></pre>
</div>
</div>
</section>
</section>
<section id="selección-de-variables-1" class="level2 page-columns page-full" data-number="11.4">
<h2 data-number="11.4" class="anchored" data-anchor-id="selección-de-variables-1"><span class="header-section-number">11.4</span> Selección de variables</h2>
<p>como siempre, hay varias alternativas y niveles de detalle para trabajar el problema de selección de variables. La función básica para construir modelos lineales es lm(). Podemos programar algoritmos para hacer selección de variables, pero haremos uso directo de la librería <code>olsrr</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(olsrr)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Adjuntando el paquete: 'olsrr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:datasets':

    rivers</code></pre>
</div>
</div>
<p>Esta librería es para facilitar el trabajo con mínimos cuadrados ordinarios (OLS: <em>Ordinary Least Squares</em>). Para un estudio más detallado de las funciones y opciones, visite la <a href="https://olsrr.rsquaredacademy.com/" target="_blank">documentación</a></p>
<p>Volvamos a trabajar con todas las variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>datos_sub2 <span class="ot">&lt;-</span> datos <span class="sc">|&gt;</span> <span class="fu">select</span>(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">densidad =</span> density,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a> <span class="at">acidez.f =</span> fixed.acidity,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a> <span class="at">acidez.v =</span> volatile.acidity,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a> <span class="at">acido.c =</span> citric.acid,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a> <span class="at">azucar =</span> residual.sugar,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a> <span class="at">cloruro =</span> chlorides,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a> <span class="at">sulfuro.l =</span> free.sulfur.dioxide,</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a> <span class="at">sulfuro.t =</span> total.sulfur.dioxide,</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a> <span class="at">ph =</span> pH,</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a> <span class="at">sulfato =</span> sulphates,</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a> alcohol,</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a> <span class="at">calidad =</span> quality</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>datos_sub2</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,143 × 12
   densidad acidez.f acidez.v acido.c azucar cloruro sulfuro.l sulfuro.t    ph
      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1    0.998      7.4     0.7     0       1.9   0.076        11        34  3.51
 2    0.997      7.8     0.88    0       2.6   0.098        25        67  3.2 
 3    0.997      7.8     0.76    0.04    2.3   0.092        15        54  3.26
 4    0.998     11.2     0.28    0.56    1.9   0.075        17        60  3.16
 5    0.998      7.4     0.7     0       1.9   0.076        11        34  3.51
 6    0.998      7.4     0.66    0       1.8   0.075        13        40  3.51
 7    0.996      7.9     0.6     0.06    1.6   0.069        15        59  3.3 
 8    0.995      7.3     0.65    0       1.2   0.065        15        21  3.39
 9    0.997      7.8     0.58    0.02    2     0.073         9        18  3.36
10    0.996      6.7     0.58    0.08    1.8   0.097        15        65  3.28
# ℹ 1,133 more rows
# ℹ 3 more variables: sulfato &lt;dbl&gt;, alcohol &lt;dbl&gt;, calidad &lt;int&gt;</code></pre>
</div>
</div>
<p>Debemos verificar la información de cada variable, hacer algunos resúmenes y algunas gráficas de forma marginal, antes de ver la posible relación con otras variables. Esto incluye estudiar los metadatos que acompañan a la base de datos<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>. Tomemos por ejemplo la variable <code>azúcar</code></p>
<div class="no-row-height column-margin column-container"><div id="fn6"><p><sup>6</sup>&nbsp;Aquí normalmente, viene información relevante del tipo de varibles, unidades, y otros apuntes importantes</p></div></div><div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>datos_sub2 <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> azucar)) <span class="sc">+</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">40</span>, <span class="at">fill =</span> <span class="st">"orange"</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Niveles de Azúcar"</span>,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Datos sobre la calidad del vino, tomado de &lt;internet&gt;"</span>,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Azúcar (unidades)"</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="flex-lineal_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>datos_sub2 <span class="sc">|&gt;</span> <span class="fu">select</span>(azucar) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     azucar      
 Min.   : 0.900  
 1st Qu.: 1.900  
 Median : 2.200  
 Mean   : 2.532  
 3rd Qu.: 2.600  
 Max.   :15.500  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>datos_sub2 <span class="ot">&lt;-</span> datos_sub2 <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>calidad)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ajustemos modelos lineales por mínimos cuadrados</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>mod_lineal1 <span class="ot">&lt;-</span> <span class="fu">ols_regress</span>(</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  densidad <span class="sc">~</span> .,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datos_sub2</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>modelo.lineal <span class="ot">&lt;-</span> <span class="fu">lm</span>(densidad <span class="sc">~</span> ., <span class="at">data =</span> datos_sub2)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>mod_lineal1</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          Model Summary                            
------------------------------------------------------------------
R                       0.921       RMSE                    0.001 
R-Squared               0.848       MSE                     0.000 
Adj. R-Squared          0.847       Coef. Var               0.076 
Pred R-Squared          0.844       AIC                -13183.269 
MAE                     0.001       SBC                -13122.772 
------------------------------------------------------------------
 RMSE: Root Mean Square Error 
 MSE: Mean Square Error 
 MAE: Mean Absolute Error 
 AIC: Akaike Information Criteria 
 SBC: Schwarz Bayesian Criteria 

                                ANOVA                                  
----------------------------------------------------------------------
               Sum of                                                 
              Squares          DF    Mean Square       F         Sig. 
----------------------------------------------------------------------
Regression      0.004          10          0.000    633.367    0.0000 
Residual        0.001        1132          0.000                      
Total           0.004        1142                                     
----------------------------------------------------------------------

                                   Parameter Estimates                                     
------------------------------------------------------------------------------------------
      model      Beta    Std. Error    Std. Beta       t         Sig      lower     upper 
------------------------------------------------------------------------------------------
(Intercept)     0.979         0.001                 1180.973    0.000     0.978     0.981 
   acidez.f     0.001         0.000        0.851      42.367    0.000     0.001     0.001 
   acidez.v     0.001         0.000        0.070       4.574    0.000     0.000     0.001 
    acido.c     0.000         0.000        0.020       0.970    0.332     0.000     0.001 
     azucar     0.000         0.000        0.308      25.144    0.000     0.000     0.000 
    cloruro     0.001         0.001        0.036       2.517    0.012     0.000     0.003 
  sulfuro.l     0.000         0.000       -0.041      -2.568    0.010     0.000     0.000 
  sulfuro.t     0.000         0.000        0.026       1.575    0.116     0.000     0.000 
         ph     0.005         0.000        0.417      24.057    0.000     0.005     0.006 
    sulfato     0.001         0.000        0.117       8.665    0.000     0.001     0.002 
    alcohol    -0.001         0.000       -0.530     -39.754    0.000    -0.001    -0.001 
------------------------------------------------------------------------------------------</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mod_lineal1)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "r"          "rsq"        "adjr"       "rmse"       "cv"        
 [6] "mse"        "mae"        "aic"        "sbc"        "sbic"      
[11] "prsq"       "error_df"   "model_df"   "total_df"   "ess"       
[16] "rss"        "tss"        "rms"        "ems"        "f"         
[21] "p"          "n"          "betas"      "sbetas"     "std_errors"
[26] "tvalues"    "pvalues"    "df"         "conf_lm"    "title"     
[31] "dependent"  "predictors" "mvars"      "model"     </code></pre>
</div>
</div>
<p>Podemos, fácilmente, ajustar todos los posibles modelos de regresión (cuidado, es costoso computacionalmente)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>mod_todos1 <span class="ot">&lt;-</span> <span class="fu">ols_step_all_possible</span>(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> modelo.lineal</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mod_todos1</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_todos1)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Una alternativa más prudente es establecer una cantidad máxima de variables a considerar, con el argumento <code>max_order</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>mod_todos2 <span class="ot">&lt;-</span> <span class="fu">ols_step_all_possible</span>(<span class="at">model =</span> modelo.lineal, </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">max_order =</span> <span class="dv">3</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>mod_todos2</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Index N                   Predictors     R-Square Adj. R-Square
1       1 1                     acidez.f 0.4644434531  0.4639740784
10      2 1                      alcohol 0.2447547038  0.2440927885
4       3 1                       azucar 0.1445117049  0.1437619343
3       4 1                      acido.c 0.1408075045  0.1400544875
8       5 1                           ph 0.1244499359  0.1236825826
5       6 1                      cloruro 0.0436395069  0.0428013295
9       7 1                      sulfato 0.0204888563  0.0196303891
6       8 1                    sulfuro.l 0.0029322570  0.0020584027
7       9 1                    sulfuro.t 0.0025175133  0.0016432955
2      10 1                     acidez.v 0.0002726303 -0.0006035550
19     11 2             acidez.f alcohol 0.6623186398  0.6617262164
13     12 2              acidez.f azucar 0.5357408599  0.5349263702
11     13 2            acidez.f acidez.v 0.5019112799  0.5010374400
17     14 2                  acidez.f ph 0.4890093394  0.4881128646
14     15 2             acidez.f cloruro 0.4829855522  0.4820785093
16     16 2           acidez.f sulfuro.t 0.4804061772  0.4794946090
12     17 2             acidez.f acido.c 0.4771973516  0.4762801540
15     18 2           acidez.f sulfuro.l 0.4679231400  0.4669896718
18     19 2             acidez.f sulfato 0.4650452520  0.4641067349
34     20 2              acido.c alcohol 0.4298642551  0.4288640170
40     21 2               azucar alcohol 0.4126489669  0.4116185265
54     22 2                   ph alcohol 0.3060954767  0.3048781004
55     23 2              sulfato alcohol 0.2811227043  0.2798615161
45     24 2              cloruro alcohol 0.2543144355  0.2530062152
27     25 2             acidez.v alcohol 0.2521814395  0.2508694771
49     26 2            sulfuro.l alcohol 0.2507664467  0.2494520018
52     27 2            sulfuro.t alcohol 0.2466640337  0.2453423916
28     28 2               acido.c azucar 0.2426609411  0.2413322761
38     29 2                    azucar ph 0.2408869920  0.2395552148
20     30 2             acidez.v acido.c 0.2100181857  0.2086322527
35     31 2               azucar cloruro 0.1777890940  0.1763466187
32     32 2                   acido.c ph 0.1719321506  0.1704794000
39     33 2               azucar sulfato 0.1631486660  0.1616805057
36     34 2             azucar sulfuro.l 0.1585862452  0.1571100807
29     35 2              acido.c cloruro 0.1553354230  0.1538535554
37     36 2             azucar sulfuro.t 0.1450302561  0.1435303092
21     37 2              acidez.v azucar 0.1448613235  0.1433610802
31     38 2            acido.c sulfuro.t 0.1421298391  0.1406248037
30     39 2            acido.c sulfuro.l 0.1418699053  0.1403644139
33     40 2              acido.c sulfato 0.1412064800  0.1396998247
43     41 2                   cloruro ph 0.1377803758  0.1362677098
25     42 2                  acidez.v ph 0.1338703514  0.1323508257
53     43 2                   ph sulfato 0.1307023617  0.1291772781
50     44 2                 sulfuro.t ph 0.1253124242  0.1237778846
47     45 2                 sulfuro.l ph 0.1252646252  0.1237300017
44     46 2              cloruro sulfato 0.0485317806  0.0468625381
41     47 2            cloruro sulfuro.l 0.0469284276  0.0452563722
42     48 2            cloruro sulfuro.t 0.0452523418  0.0435773459
22     49 2             acidez.v cloruro 0.0436620730  0.0419842872
48     50 2            sulfuro.l sulfato 0.0239835399  0.0222712303
26     51 2             acidez.v sulfato 0.0238871446  0.0221746659
51     52 2            sulfuro.t sulfato 0.0226364416  0.0209217687
46     53 2          sulfuro.l sulfuro.t 0.0160618641  0.0143356568
23     54 2           acidez.v sulfuro.l 0.0032013902  0.0014526208
24     55 2           acidez.v sulfuro.t 0.0026775061  0.0009278175
76     56 3      acidez.f azucar alcohol 0.7523797950  0.7517275908
90     57 3          acidez.f ph alcohol 0.7358250254  0.7351292177
63     58 3    acidez.f acidez.v alcohol 0.6710520310  0.6701856184
91     59 3     acidez.f sulfato alcohol 0.6677486859  0.6668735727
88     60 3   acidez.f sulfuro.t alcohol 0.6638343940  0.6629489710
81     61 3     acidez.f cloruro alcohol 0.6637316494  0.6628459557
85     62 3   acidez.f sulfuro.l alcohol 0.6633524266  0.6624657342
70     63 3     acidez.f acido.c alcohol 0.6626717631  0.6617832779
57     64 3     acidez.f acidez.v azucar 0.5693228934  0.5681885376
74     65 3           acidez.f azucar ph 0.5602166978  0.5590583573
64     66 3      acidez.f acido.c azucar 0.5540850429  0.5529105523
71     67 3      acidez.f azucar cloruro 0.5506439071  0.5494603529
125    68 3       acido.c azucar alcohol 0.5463183914  0.5451234442
73     69 3    acidez.f azucar sulfuro.t 0.5407493699  0.5395397545
75     70 3      acidez.f azucar sulfato 0.5365238488  0.5353031039
72     71 3    acidez.f azucar sulfuro.l 0.5357755236  0.5345528077
79     72 3          acidez.f cloruro ph 0.5243105246  0.5230576111
61     73 3         acidez.f acidez.v ph 0.5224886201  0.5212309079
58     74 3    acidez.f acidez.v cloruro 0.5162749935  0.5150009153
60     75 3  acidez.f acidez.v sulfuro.t 0.5154694739  0.5141932741
86     76 3        acidez.f sulfuro.t ph 0.5140778190  0.5127979537
62     77 3    acidez.f acidez.v sulfato 0.5073777029  0.5060801903
59     78 3  acidez.f acidez.v sulfuro.l 0.5065128240  0.5052130333
65     79 3     acidez.f acido.c cloruro 0.5052131015  0.5039098875
56     80 3    acidez.f acidez.v acido.c 0.5020913794  0.5007799432
67     81 3   acidez.f acido.c sulfuro.t 0.4982592795  0.4969377500
68     82 3          acidez.f acido.c ph 0.4969816121  0.4956567173
78     83 3   acidez.f cloruro sulfuro.t 0.4969757547  0.4956508445
83     84 3        acidez.f sulfuro.l ph 0.4936129922  0.4922792248
89     85 3          acidez.f ph sulfato 0.4905376019  0.4891957343
77     86 3   acidez.f cloruro sulfuro.l 0.4859479926  0.4845940365
80     87 3     acidez.f cloruro sulfato 0.4837047807  0.4823449162
66     88 3   acidez.f acido.c sulfuro.l 0.4817445293  0.4803795018
82     89 3 acidez.f sulfuro.l sulfuro.t 0.4814056683  0.4800397482
69     90 3     acidez.f acido.c sulfato 0.4808374989  0.4794700823
87     91 3   acidez.f sulfuro.t sulfato 0.4807516346  0.4793839918
84     92 3   acidez.f sulfuro.l sulfato 0.4683530971  0.4669527980
98     93 3     acidez.v acido.c alcohol 0.4593033288  0.4578791936
154    94 3            azucar ph alcohol 0.4505187737  0.4490715010
155    95 3       azucar sulfato alcohol 0.4471658030  0.4457096989
149    96 3     azucar sulfuro.l alcohol 0.4347704545  0.4332817024
137    97 3    acido.c sulfuro.t alcohol 0.4346066053  0.4331174216
134    98 3    acido.c sulfuro.l alcohol 0.4328709996  0.4313772446
140    99 3      acido.c sulfato alcohol 0.4327826856  0.4312886979
130   100 3      acido.c cloruro alcohol 0.4303964061  0.4288961332
139   101 3           acido.c ph alcohol 0.4299122150  0.4284106669
152   102 3     azucar sulfuro.t alcohol 0.4297640058  0.4282620673
104   103 3      acidez.v azucar alcohol 0.4205279255  0.4190016602
145   104 3       azucar cloruro alcohol 0.4165499828  0.4150132400
175   105 3           ph sulfato alcohol 0.3260185697  0.3242433771
170   106 3         sulfuro.l ph alcohol 0.3092894279  0.3074701726
173   107 3         sulfuro.t ph alcohol 0.3084026411  0.3065810502
164   108 3           cloruro ph alcohol 0.3076877354  0.3058642615
118   109 3          acidez.v ph alcohol 0.3063994315  0.3045725643
92    110 3      acidez.v acido.c azucar 0.2954210821  0.2935652992
171   111 3    sulfuro.l sulfato alcohol 0.2883577208  0.2864833338
174   112 3    sulfuro.t sulfato alcohol 0.2838748996  0.2819887053
119   113 3     acidez.v sulfato alcohol 0.2825096393  0.2806198490
165   114 3      cloruro sulfato alcohol 0.2815903335  0.2796981219
123   115 3            acido.c azucar ph 0.2710142725  0.2690942047
109   116 3     acidez.v cloruro alcohol 0.2619100788  0.2599660316
159   117 3    cloruro sulfuro.l alcohol 0.2603959510  0.2584479157
113   118 3   acidez.v sulfuro.l alcohol 0.2583531363  0.2563997205
162   119 3    cloruro sulfuro.t alcohol 0.2562678794  0.2543089713
120   120 3       acido.c azucar cloruro 0.2550496035  0.2530874866
116   121 3   acidez.v sulfuro.t alcohol 0.2537974870  0.2518320721
143   122 3            azucar cloruro ph 0.2512531017  0.2492809852
121   123 3     acido.c azucar sulfuro.l 0.2509485225  0.2489756038
168   124 3  sulfuro.l sulfuro.t alcohol 0.2508769407  0.2489038334
102   125 3           acidez.v azucar ph 0.2489828843  0.2470047883
147   126 3          azucar sulfuro.l ph 0.2489564478  0.2469782821
153   127 3            azucar ph sulfato 0.2473751372  0.2453928066
124   128 3       acido.c azucar sulfato 0.2438177722  0.2418260718
122   129 3     acido.c azucar sulfuro.t 0.2432297923  0.2412365433
150   130 3          azucar sulfuro.t ph 0.2420785130  0.2400822316
96    131 3          acidez.v acido.c ph 0.2321909249  0.2301686008
93    132 3     acidez.v acido.c cloruro 0.2137158265  0.2116448409
97    133 3     acidez.v acido.c sulfato 0.2127435482  0.2106700018
94    134 3   acidez.v acido.c sulfuro.l 0.2105088975  0.2084294653
95    135 3   acidez.v acido.c sulfuro.t 0.2100507939  0.2079701551
141   136 3     azucar cloruro sulfuro.l 0.1920210686  0.1898929415
144   137 3       azucar cloruro sulfato 0.1831981143  0.1810467485
128   138 3           acido.c cloruro ph 0.1801649123  0.1780055574
142   139 3     azucar cloruro sulfuro.t 0.1786443146  0.1764809545
148   140 3     azucar sulfuro.l sulfato 0.1782943766  0.1761300948
99    141 3      acidez.v azucar cloruro 0.1778585507  0.1756931211
135   142 3         acido.c sulfuro.t ph 0.1727261476  0.1705471997
132   143 3         acido.c sulfuro.l ph 0.1725034279  0.1703238935
138   144 3           acido.c ph sulfato 0.1722917263  0.1701116343
103   145 3      acidez.v azucar sulfato 0.1665895580  0.1643944471
151   146 3     azucar sulfuro.t sulfato 0.1638275927  0.1616252071
146   147 3   azucar sulfuro.l sulfuro.t 0.1637091467  0.1615064491
100   148 3    acidez.v azucar sulfuro.l 0.1589313283  0.1567160464
126   149 3    acido.c cloruro sulfuro.l 0.1566511980  0.1544299105
127   150 3    acido.c cloruro sulfuro.t 0.1563291046  0.1541069688
129   151 3      acido.c cloruro sulfato 0.1557254095  0.1535016836
131   152 3  acido.c sulfuro.l sulfuro.t 0.1479043252  0.1456599995
101   153 3    acidez.v azucar sulfuro.t 0.1454543563  0.1432035776
117   154 3          acidez.v ph sulfato 0.1451306781  0.1428790469
107   155 3          acidez.v cloruro ph 0.1447016428  0.1424488816
136   156 3    acido.c sulfuro.t sulfato 0.1425066084  0.1402480657
133   157 3    acido.c sulfuro.l sulfato 0.1423478348  0.1400888739
163   158 3           cloruro ph sulfato 0.1395509907  0.1372846632
157   159 3         cloruro sulfuro.l ph 0.1388590769  0.1365909269
160   160 3         cloruro sulfuro.t ph 0.1384337246  0.1361644543
111   161 3        acidez.v sulfuro.l ph 0.1345855016  0.1323060956
114   162 3        acidez.v sulfuro.t ph 0.1342864943  0.1320063007
169   163 3         sulfuro.l ph sulfato 0.1317553892  0.1294685290
172   164 3         sulfuro.t ph sulfato 0.1314913012  0.1292037454
166   165 3       sulfuro.l sulfuro.t ph 0.1295059879  0.1272132030
156   166 3  cloruro sulfuro.l sulfuro.t 0.0577604435  0.0552786888
158   167 3    cloruro sulfuro.l sulfato 0.0520773349  0.0495806115
161   168 3    cloruro sulfuro.t sulfato 0.0500915565  0.0475896028
108   169 3     acidez.v cloruro sulfato 0.0493570977  0.0468532094
105   170 3   acidez.v cloruro sulfuro.l 0.0469494792  0.0444392496
106   171 3   acidez.v cloruro sulfuro.t 0.0452553471  0.0427406553
167   172 3  sulfuro.l sulfuro.t sulfato 0.0369313852  0.0343947690
112   173 3   acidez.v sulfuro.l sulfato 0.0274364093  0.0248747844
115   174 3   acidez.v sulfuro.t sulfato 0.0255958950  0.0230294224
110   175 3 acidez.v sulfuro.l sulfuro.t 0.0160808558  0.0134893216
     Mallow's Cp
1    0.462417881
10   0.241387167
4    0.140929865
3    0.137658610
8    0.120844743
5    0.038181558
9    0.017392261
6   -0.001242004
7   -0.001815567
2   -0.003237354
19   0.660147872
13   0.532514579
11   0.498795933
17   0.485579622
14   0.479409257
16   0.476145127
12   0.474060157
15   0.464318876
18   0.462141085
34   0.426238322
40   0.407685460
54   0.301436889
55   0.276048963
45   0.248809275
27   0.247646323
49   0.245674152
52   0.241996182
28   0.237761598
38   0.235572044
20   0.205085575
35   0.171984904
32   0.167116074
39   0.158664601
36   0.153634512
29   0.148374687
37   0.138444178
21   0.139799766
31   0.135849149
30   0.136440138
33   0.136759986
43   0.130883095
25   0.128757296
53   0.125299413
50   0.118664008
47   0.119296314
44   0.041458662
41   0.039327328
42   0.037524484
22   0.036516046
48   0.018517329
26   0.018922311
51   0.017059924
46   0.008806660
23  -0.002716248
24  -0.003442441
76   0.749530020
90   0.733271045
63   0.668247077
91   0.664793183
88   0.660618997
81   0.660673772
85   0.660163093
70   0.659828770
57   0.565379181
74   0.555789141
64   0.549867194
71   0.546601229
125  0.541499255
73   0.535014822
75   0.532602025
72   0.531688711
79   0.519538560
61   0.518078520
58   0.511848489
60   0.510477427
86   0.508732422
62   0.503359546
59   0.501990114
65   0.500866756
56   0.497977567
67   0.493138024
68   0.492506947
78   0.491401026
83   0.488647882
89   0.486078703
77   0.481048571
80   0.479247996
66   0.477085323
82   0.475348881
69   0.476748085
87   0.475636991
84   0.463867372
98   0.454381287
154  0.444556369
155  0.441015263
149  0.428987136
137  0.429644518
134  0.427741115
140  0.427767831
130  0.424923282
139  0.425058079
152  0.423409075
104  0.414472769
145  0.410553604
175  0.319255856
170  0.302895686
173  0.302228453
164  0.301021738
118  0.300510816
92   0.289245993
171  0.281705662
174  0.277724651
119  0.276232799
165  0.274232435
123  0.264622763
109  0.255178118
159  0.253194891
113  0.252097538
162  0.249507441
120  0.247645446
116  0.247908352
143  0.243852099
121  0.244735841
168  0.244352731
102  0.242516054
147  0.242247199
153  0.240725292
124  0.237800992
122  0.234956900
150  0.233512101
96   0.225682103
93   0.205541674
97   0.206328861
94   0.203534578
95   0.202381560
141  0.185035225
144  0.176133208
128  0.171812375
142  0.170137318
148  0.172536801
99   0.170629706
135  0.164657437
132  0.165386267
138  0.166011843
103  0.160621204
151  0.156527226
146  0.154498671
100  0.152528852
126  0.147585957
127  0.146484222
129  0.147454093
131  0.138936751
101  0.137339327
117  0.137818597
107  0.136504986
136  0.134929093
133  0.135620186
163  0.130904254
157  0.129773727
160  0.128722255
111  0.127170187
114  0.126260129
169  0.124032893
172  0.123094224
166  0.120094281
156  0.047390681
158  0.042858431
161  0.040767649
108  0.040487813
105  0.037664175
106  0.035797000
167  0.028348030
112  0.020152280
115  0.018212730
110  0.007031116</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_todos2)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="flex-lineal_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="flex-lineal_files/figure-html/unnamed-chunk-27-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Podemos solicitar directamente la selección de modelos</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>mod_todos3 <span class="ot">&lt;-</span> <span class="fu">ols_step_best_subset</span>(</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> modelo.lineal, </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_order =</span> <span class="dv">5</span>,</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"aic"</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>mod_todos3</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_todos3)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>De igual forma, podemos hacer selección tipo <em>forward</em> y <em>backward</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>mod_todos_f <span class="ot">&lt;-</span> <span class="fu">ols_step_forward_adj_r2</span>(</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> modelo.lineal</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>mod_todos_f</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                                  Stepwise Summary                                  
----------------------------------------------------------------------------------
Step    Variable         AIC           SBC           SBIC         R2       Adj. R2 
----------------------------------------------------------------------------------
 0      Base Model    -11047.195    -11037.112    -14294.017    0.00000    0.00000 
 1      acidez.f      -11758.940    -11743.816    -15006.510    0.46444    0.46397 
 2      alcohol       -12284.096    -12263.930    -15531.667    0.66232    0.66173 
 3      azucar        -12636.662    -12611.455    -15883.701    0.75238    0.75173 
 4      ph            -13055.656    -13025.407    -16300.435    0.82867    0.82807 
 5      sulfato       -13145.133    -13109.843    -16389.211    0.84185    0.84116 
 6      acidez.v      -13174.465    -13134.133    -16418.228    0.84613    0.84531 
 7      cloruro       -13180.810    -13135.437    -16424.467    0.84725    0.84630 
 8      sulfuro.l     -13182.748    -13132.334    -16426.338    0.84777    0.84670 
 9      sulfuro.t     -13184.320    -13128.864    -16427.836    0.84825    0.84704 
----------------------------------------------------------------------------------

Final Model Output 
------------------

                          Model Summary                            
------------------------------------------------------------------
R                       0.921       RMSE                    0.001 
R-Squared               0.848       MSE                     0.000 
Adj. R-Squared          0.847       Coef. Var               0.076 
Pred R-Squared          0.844       AIC                -13184.320 
MAE                     0.001       SBC                -13128.864 
------------------------------------------------------------------
 RMSE: Root Mean Square Error 
 MSE: Mean Square Error 
 MAE: Mean Absolute Error 
 AIC: Akaike Information Criteria 
 SBC: Schwarz Bayesian Criteria 

                                ANOVA                                  
----------------------------------------------------------------------
               Sum of                                                 
              Squares          DF    Mean Square       F         Sig. 
----------------------------------------------------------------------
Regression      0.004           9          0.000    703.673    0.0000 
Residual        0.001        1133          0.000                      
Total           0.004        1142                                     
----------------------------------------------------------------------

                                   Parameter Estimates                                     
------------------------------------------------------------------------------------------
      model      Beta    Std. Error    Std. Beta       t         Sig      lower     upper 
------------------------------------------------------------------------------------------
(Intercept)     0.979         0.001                 1182.937    0.000     0.978     0.981 
   acidez.f     0.001         0.000        0.861      51.217    0.000     0.001     0.001 
    alcohol    -0.001         0.000       -0.527     -40.720    0.000    -0.001    -0.001 
     azucar     0.000         0.000        0.308      25.232    0.000     0.000     0.000 
         ph     0.005         0.000        0.416      24.040    0.000     0.005     0.006 
    sulfato     0.001         0.000        0.117       8.711    0.000     0.001     0.002 
   acidez.v     0.001         0.000        0.062       4.790    0.000     0.000     0.001 
    cloruro     0.002         0.001        0.040       2.963    0.003     0.001     0.003 
  sulfuro.l     0.000         0.000       -0.043      -2.728    0.006     0.000     0.000 
  sulfuro.t     0.000         0.000        0.031       1.883    0.060     0.000     0.000 
------------------------------------------------------------------------------------------</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(mod_todos_f)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="flex-lineal_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>plot1</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="flex-lineal_files/figure-html/unnamed-chunk-29-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ejercicio para reducir el estrés
</div>
</div>
<div class="callout-body-container callout-body">
<p>Graficar directamente con <code>ggplot2</code> y mejorar los resultados gráficos</p>
</div>
</div>
<p>Una alternativa es convertir a un gráfico interactivo con <code>plotly</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Adjuntando el paquete: 'plotly'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ggplot2':

    last_plot</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    filter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:graphics':

    layout</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(plot1)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-da8b50190d1bf40dfc07" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-da8b50190d1bf40dfc07">{"x":{"data":[{"x":[1,2,3,4,5,6,7,8,9],"y":[0.46397407836644111,0.66172621639516582,0.75172759081999474,0.82807099633286196,0.84115511238893981,0.84531415936336995,0.84630416068386805,0.84669771794789628,0.84704116221558501],"text":["a: 1<br />b: 0.4639741","a: 2<br />b: 0.6617262","a: 3<br />b: 0.7517276","a: 4<br />b: 0.8280710","a: 5<br />b: 0.8411551","a: 6<br />b: 0.8453142","a: 7<br />b: 0.8463042","a: 8<br />b: 0.8466977","a: 9<br />b: 0.8470412"],"type":"scatter","mode":"lines+markers","line":{"width":1.8897637795275593,"color":"rgba(0,0,255,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(0,0,255,1)","opacity":1,"size":7.559055118110237,"symbol":"circle-open","line":{"width":1.8897637795275593,"color":"rgba(0,0,255,1)"}},"frame":null},{"x":[1.1000000000000001,2.1000000000000001,3.1000000000000001,4.0999999999999996,5.0999999999999996,6.0999999999999996,7.0999999999999996,8.0999999999999996,9.0999999999999996],"y":[0.46397407836644111,0.66172621639516582,0.75172759081999474,0.82807099633286196,0.84115511238893981,0.84531415936336995,0.84630416068386805,0.84669771794789628,0.84704116221558501],"text":["[acidez.f, 0.464]","[alcohol, 0.662]","[azucar, 0.752]","[ph, 0.828]","[sulfato, 0.841]","[acidez.v, 0.845]","[cloruro, 0.846]","[sulfuro.l, 0.847]","[sulfuro.t, 0.847]"],"hovertext":["x: 1<br />y: 0.4639741<br />tx: [acidez.f, 0.464]","x: 2<br />y: 0.6617262<br />tx: [alcohol, 0.662]","x: 3<br />y: 0.7517276<br />tx: [azucar, 0.752]","x: 4<br />y: 0.8280710<br />tx: [ph, 0.828]","x: 5<br />y: 0.8411551<br />tx: [sulfato, 0.841]","x: 6<br />y: 0.8453142<br />tx: [acidez.v, 0.845]","x: 7<br />y: 0.8463042<br />tx: [cloruro, 0.846]","x: 8<br />y: 0.8466977<br />tx: [sulfuro.l, 0.847]","x: 9<br />y: 0.8470412<br />tx: [sulfuro.t, 0.847]"],"textfont":{"size":11.338582677165356,"color":"rgba(0,0,0,1)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[null],"y":[null],"text":"Base Model  : 0.000<br />Final Model : 0.847","hovertext":"x: Inf<br />y: Inf","textfont":{"size":11.338582677165356,"color":"rgba(0,0,0,1)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":40.182648401826491,"l":43.105022831050235},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"Stepwise Adj. R2 Forward Selection","font":{"color":"rgba(0,0,0,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.5,10.5],"tickmode":"array","ticktext":["0.0","2.5","5.0","7.5","10.0"],"tickvals":[0,2.5,5,7.5,10],"categoryorder":"array","categoryarray":["0.0","2.5","5.0","7.5","10.0"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Step","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.41834448215420678,0.91182411262027652],"tickmode":"array","ticktext":["0.5","0.6","0.7","0.8","0.9"],"tickvals":[0.5,0.60000000000000009,0.70000000000000007,0.80000000000000004,0.90000000000000002],"categoryorder":"array","categoryarray":["0.5","0.6","0.7","0.8","0.9"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Adj. R2","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"fb853b829a9":{"x":{},"y":{},"type":"scatter"},"fb82a0f72a1":{"x":{},"y":{}},"fb8a4e4309":{"x":{},"y":{},"label":{}},"fb85dc03259":{"x":{},"y":{}}},"cur_data":"fb853b829a9","visdat":{"fb853b829a9":["function (y) ","x"],"fb82a0f72a1":["function (y) ","x"],"fb8a4e4309":["function (y) ","x"],"fb85dc03259":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Con selección tipo <em>backward</em>, obtenemos</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>mod_todos4 <span class="ot">&lt;-</span> <span class="fu">ols_step_backward_adj_r2</span>(modelo.lineal)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>mod_todos4</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                                  Stepwise Summary                                  
----------------------------------------------------------------------------------
Step    Variable         AIC           SBC           SBIC         R2       Adj. R2 
----------------------------------------------------------------------------------
 0      Full Model    -13183.269    -13122.772    -16426.749    0.84837    0.84703 
 1      acido.c       -13184.320    -13128.864    -16427.837    0.84825    0.84704 
----------------------------------------------------------------------------------

Final Model Output 
------------------

                          Model Summary                            
------------------------------------------------------------------
R                       0.921       RMSE                    0.001 
R-Squared               0.848       MSE                     0.000 
Adj. R-Squared          0.847       Coef. Var               0.076 
Pred R-Squared          0.844       AIC                -13184.320 
MAE                     0.001       SBC                -13128.864 
------------------------------------------------------------------
 RMSE: Root Mean Square Error 
 MSE: Mean Square Error 
 MAE: Mean Absolute Error 
 AIC: Akaike Information Criteria 
 SBC: Schwarz Bayesian Criteria 

                                ANOVA                                  
----------------------------------------------------------------------
               Sum of                                                 
              Squares          DF    Mean Square       F         Sig. 
----------------------------------------------------------------------
Regression      0.004           9          0.000    703.673    0.0000 
Residual        0.001        1133          0.000                      
Total           0.004        1142                                     
----------------------------------------------------------------------

                                   Parameter Estimates                                     
------------------------------------------------------------------------------------------
      model      Beta    Std. Error    Std. Beta       t         Sig      lower     upper 
------------------------------------------------------------------------------------------
(Intercept)     0.979         0.001                 1182.937    0.000     0.978     0.981 
   acidez.f     0.001         0.000        0.861      51.217    0.000     0.001     0.001 
   acidez.v     0.001         0.000        0.062       4.790    0.000     0.000     0.001 
     azucar     0.000         0.000        0.308      25.232    0.000     0.000     0.000 
    cloruro     0.002         0.001        0.040       2.963    0.003     0.001     0.003 
  sulfuro.l     0.000         0.000       -0.043      -2.728    0.006     0.000     0.000 
  sulfuro.t     0.000         0.000        0.031       1.883    0.060     0.000     0.000 
         ph     0.005         0.000        0.416      24.040    0.000     0.005     0.006 
    sulfato     0.001         0.000        0.117       8.711    0.000     0.001     0.002 
    alcohol    -0.001         0.000       -0.527     -40.720    0.000    -0.001    -0.001 
------------------------------------------------------------------------------------------</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot</span>(mod_todos4)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_line()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="flex-lineal_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>plot2</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_line()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="flex-lineal_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(plot2)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-c6f233a87e6b95283a3f" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-c6f233a87e6b95283a3f">{"x":{"data":[{"x":[1],"y":[0.84704116221558501],"text":"a: 1<br />b: 0.8470412","type":"scatter","mode":"lines+markers","line":{"width":1.8897637795275593,"color":"rgba(0,0,255,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(0,0,255,1)","opacity":1,"size":7.559055118110237,"symbol":"circle-open","line":{"width":1.8897637795275593,"color":"rgba(0,0,255,1)"}},"frame":null},{"x":[1.1000000000000001],"y":[0.84704116221558501],"text":"[acido.c, 0.847]","hovertext":"x: 1<br />y: 0.8470412<br />tx: [acido.c, 0.847]","textfont":{"size":11.338582677165356,"color":"rgba(0,0,0,1)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[null],"y":[null],"text":" Full Model  : 0.847<br />Final Model : 0.847","hovertext":"x: Inf<br />y: Inf","textfont":{"size":11.338582677165356,"color":"rgba(0,0,0,1)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":40.182648401826491,"l":54.794520547945211},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"Stepwise Adj. R2 Backward Elimination","font":{"color":"rgba(0,0,0,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.10000000000000001,2.1000000000000001],"tickmode":"array","ticktext":["0.0","0.5","1.0","1.5","2.0"],"tickvals":[0,0.5,1,1.5,2],"categoryorder":"array","categoryarray":["0.0","0.5","1.0","1.5","2.0"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Step","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.80045389829372782,0.8936284261374422],"tickmode":"array","ticktext":["0.825","0.850","0.875"],"tickvals":[0.82500000000000007,0.85000000000000009,0.875],"categoryorder":"array","categoryarray":["0.825","0.850","0.875"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Adj. R2","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"fb851e35e08":{"x":{},"y":{},"type":"scatter"},"fb83c8b779d":{"x":{},"y":{}},"fb864431fb3":{"x":{},"y":{},"label":{}},"fb8186c5f92":{"x":{},"y":{}}},"cur_data":"fb851e35e08","visdat":{"fb851e35e08":["function (y) ","x"],"fb83c8b779d":["function (y) ","x"],"fb864431fb3":["function (y) ","x"],"fb8186c5f92":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>


</section>
</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./reg-multiple.html" class="pagination-link" aria-label="Regresión lineal múltiple">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Regresión lineal múltiple</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link" aria-label="Referencias">
        <span class="nav-page-text">Referencias</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>